<html ng-app="MyApp">
  <head>
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.22/angular.js"></script>
	<script src="Chart.js"></script>
    <script>
angular.module('MyApp', ['controllers', 'services']);
		
angular.module('controllers',[])
.controller('CloudController', ['$scope','Comments','PrepChart','MakeChart', function($scope, Comments, PrepChart, MakeChart){
	Comments.get('bonerpalooza')
	.then(function(array) {
		$scope.array = array;
		return PrepChart.parse(array);
	})
	.then(function(string) {
		$scope.string = string;
		MakeChart.make(string);
	});
	//http://solutionoptimist.com/2013/12/27/javascript-promise-chains-2/
}]);
		
angular.module('services', [])
.factory('Comments', ['$http', function($http){
	return {
		get: function(user){
			return $http.get('http://www.reddit.com/user/' + user + '/comments/cjvkpaf.json?limit=100');
		}
	};
}])
.factory('PrepChart', [function(){
	return {
		parse: function(array){
			console.log(array);
			var data = { labels: [], datasets: [] }
			array.data.data.children.forEach(function(comment){
				if (data.labels.indexOf(comment.data.subreddit) == -1) {
					data.datasets.push({
						label: comment.data.subreddit
					});
				}
			});
		}
	};
}])
.factory('MakeChart', [function(){
	return {
		make: function(data){
			console.log(data);
		}
	};
}]);
//http://stackoverflow.com/questions/13937318/convert-angular-http-get-function-to-a-service
		/* make big string
		array.data.data.children.reduce(function(prev, comment){
				return prev += comment.data.body;
			}, '');		*/
    </script>
	    
	  <style>
		  ul { list-style: none; padding: 0 10px; }
	  </style>
  </head>
<body ng-controller="CloudController as cloud">
	<ul>
		<li ng-repeat="comment in comments">
			{{comment.data.body}}<hr>
		</li>
	</ul>
</body>
</html>